# Last Stop

## 核心玩法设计

**基础机制**

-   玩家在网格地图上放置/旋转公交路线片段（直线、转弯、T型路口等）
-   乘客从起点站出发，需要通过换乘到达目的地
-   每条新路线会影响整个交通网络的客流分布

**连锁反应元素**

-   **客流连锁**：一条路线开通后，会分流其他路线的乘客，改变整个网络的拥挤程度
-   **换乘连锁**：在交汇点，乘客可以换乘，创造更多可能的路径组合
-   **时间连锁**：公交车有发车间隔，乘客的到达时机会影响后续换乘

## 游戏元素设计

**路线片段类型**

-   直线段、L型转弯、T型分岔、十字路口
-   特殊站点：始发站、终点站、换乘枢纽
-   障碍物：无法通行的建筑、河流等

**乘客系统**

-   不同颜色代表不同目的地的乘客
-   每个乘客有耐心值，等待太久会生气离开
-   乘客会选择最短/最快的路径组合

**挑战设计**

-   **基础关卡**：连接A到B的简单路线
-   **多目标**：同时满足多组起终点需求
-   **资源限制**：有限的路线片段数量
-   **时间压力**：在限定时间内完成路网建设


## 代码结构

-   `src/game`：游戏核心逻辑
    -   `grid.rs`：网格系统
    -   `passenger.rs`：乘客系统

## 关卡进阶设计详解

### 1\. 教学关卡 - 基础连接

**设计目标**：让玩家理解基本操作和游戏规则

**关卡特点**：

-   只有一个起点站和一个终点站
-   提供充足的直线和转弯路段
-   没有时间压力，让玩家熟悉拖拽、旋转操作
-   成功连接后有明显的视觉反馈（乘客顺利到达）

**教学要素**：

-   显示操作提示："拖拽路段到网格"、"右键旋转方向"
-   高亮显示可放置的位置
-   路径预览功能，显示乘客将要走的路线

### 2\. 多线换乘 - 引入复杂性

**设计目标**：教会玩家换乘机制和多条路线的协调

**关卡特点**：

-   2-3个起点，2-3个终点
-   必须通过中转站换乘才能到达某些目的地
-   引入不同颜色的乘客（红色乘客要去红色终点站）
-   换乘站有容量限制，过多乘客会造成拥堵

**新机制**：

    换乘逻辑：
    - 乘客到达换乘站后，会等待前往目的地的下一班车
    - 换乘等待时间影响乘客满意度
    - 多条路线在换乘站的时刻表协调很重要

### 3\. 网络优化 - 策略深度

**设计目标**：在满足基本需求基础上，追求效率最优解

**评分机制**：

-   ⭐基础分：所有乘客到达目的地
-   ⭐⭐效率分：平均换乘次数少于2次
-   ⭐⭐⭐完美分：使用路段数量少于建议值

**优化挑战**：

-   路线片段数量限制（比如只能用12个路段）
-   建设成本概念：直线段1分，转弯段2分，交叉路口3分
-   乘客流量显示：粗线表示客流大的路段

**策略要素**：

    玩家需要思考：
    - 是建设直达路线还是共享主干道？
    - 如何平衡换乘便利性和建设成本？
    - 哪些路段是客流热点，需要重点规划？

### 4\. 实时挑战 - 动态适应

**设计目标**：测试玩家的快速反应和网络适应能力

**动态元素**：

-   **突发客流**：某个时段特定路线乘客激增
-   **设备故障**：某个路段临时无法通行，需要绕行
-   **新需求**：游戏中途出现新的起终点需求
-   **时间窗口**：某些乘客只在特定时间段出现

**应对机制**：

-   玩家可以实时调整路线（但有调整成本）
-   临时路线系统：可以快速铺设临时接驳线
-   优先级设置：可以让某些路线的班次更频繁

### 5\. 城市规划 - 终极挑战

**设计目标**：模拟真实城市交通规划的复杂性

**复杂要素**：

-   **地形限制**：河流、山丘、建筑群
-   **多种交通工具**：公交、地铁、轻轨，各有不同特性
-   **区域特点**：住宅区（早晚客流）、商业区（全天客流）、工业区（特定时段）
-   **预算管理**：不同类型的路线有不同建设和维护成本

**胜利条件**：

    综合评分系统：
    - 乘客满意度：等待时间、换乘便利性
    - 经济效益：客流量vs建设成本
    - 网络韧性：单点故障的影响程度
    - 环境影响：路线长度、土地占用

## 渐进式难度曲线

**技能培养路径**：

1.  **空间思维**（教学关卡）→ 理解网格和路线连接
2.  **系统思维**（多线换乘）→ 理解不同路线间的相互影响
3.  **优化思维**（网络优化）→ 在约束条件下寻找最佳解
4.  **适应思维**（实时挑战）→ 应对动态变化的能力
5.  **综合规划**（城市规划）→ 平衡多个目标的宏观视野

## 连锁反应的体现

每个关卡都强化"连锁反应"这个核心概念：

-   **局部决策的全局影响**：在一个地方修改路线，整个网络的客流都会重新分配
-   **时间维度的连锁**：一个延误会影响后续所有换乘
-   **资源竞争的连锁**：热门路段的拥堵会迫使乘客选择替代路线


这个寻路系统专门为公交拼图游戏设计，具有以下核心特性：

## 🎯 核心算法特点

### **多模式寻路**

-   **步行模式**：直接点对点移动
-   **公交模式**：考虑路线、班次频率、等车时间
-   **换乘模式**：多路线组合，包含换乘惩罚

### **智能路径选择**

-   使用改进的A\*算法，考虑：
    -   实际行程时间
    -   等车时间（基于班次频率）
    -   换乘成本（时间 + 心理成本）
    -   路线容量和拥挤程度



audio/
    ├── background_music.ogg          # 轻松愉快的背景音乐 https://opengameart.org/content/white-sands-day-night
    ├── place_segment.ogg             # 咔嗒声 (clicking sound) https://opengameart.org/content/click-0
    ├── remove_segment.ogg            # 轻微的撤销声 https://opengameart.org/content/mouse-click
    ├── passenger_arrive.ogg          # 愉快的叮咚声 https://opengameart.org/content/completion-sound
    ├── objective_complete.ogg        # 成功提示音  https://opengameart.org/content/new-thing-get
    ├── level_complete.ogg            # 胜利音乐 https://opengameart.org/content/level-finish-fanfares
    └── button_click.ogg              # 按钮点击声 https://opengameart.org/content/menu-selection-click
    └── error.ogg                     # 错误提示音 https://opengameart.org/content/error


